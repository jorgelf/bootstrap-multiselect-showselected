/**
 * MIT License
 * 
 * Copyright (c) 2021 Jorge López Fernández
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 */
$.fn.multiselect.Constructor.prototype.defaults.showSelectedValues=!1,$.fn.multiselect.Constructor.prototype.defaults.showSelectedValuesCollapsed=!1,$.fn.multiselect.Constructor.prototype.defaults.showSelectedValuesOnlyOnce=!1,$.fn.multiselect.Constructor.prototype.defaults.showSelectedValuesEmpty=!0,$.fn.multiselect.Constructor.prototype.defaults.selectedValuesTitleText="Values initially selected",$.fn.multiselect.Constructor.prototype.defaults.selectedValuesNoValuesText="None",$.fn.multiselect.Constructor.prototype.buildDropdownOriginal=$.fn.multiselect.Constructor.prototype.buildDropdown,$.fn.multiselect.Constructor.prototype.buildDropdown=function(){if(this.buildDropdownOriginal(),this.oldDropdownVersion=!("$popupContainer"in this),this.options.showSelectedValues){var e=this.options.selectedValuesTitleText,t=(this.options.selectedValuesTitleText,$(this.oldDropdownVersion?'<li class="multiselect-item multiselect-group multiselect-selected-values"><a href="javascript:void(0);"><label><b></b></label></a></li>':"<span class='multiselect-group multiselect-selected-values dropdown-item-text'></span>"));this.options.enableHTML?(this.oldDropdownVersion?t.find("label b"):t).html(" "+e):(this.oldDropdownVersion?t.find("label b"):t).text(" "+e),this.$dropdownContainer=this.oldDropdownVersion?this.$ul:this.$popupContainer,t.find(".form-check").addClass("d-inline-block"),this.oldDropdownVersion?$("a",t).append('<span class="caret-container"><b class="caret"></b></span>'):t.append('<span class="caret-container dropdown-toggle pl-1"></span>'),this.$dropdownContainer.append(t),$(".multiselect-selected-values",this.$dropdownContainer).off("click"),$(".multiselect-selected-values",this.$dropdownContainer).on("click",$.proxy(function(e){var t=$(e.target);this.oldDropdownVersion&&(t=t.closest("li"));var s=t.nextUntil(":not(.multiselect-selected-values-entry)"),l=!0;s.each(function(){l=l&&!$(this).hasClass("multiselect-collapsible-hidden")}),l?s.hide().addClass("multiselect-collapsible-hidden"):s.show().removeClass("multiselect-collapsible-hidden"),t.toggleClass("collapsed",l)},this)),this.createDivider()}},$.fn.multiselect.Constructor.prototype.refreshOriginal=$.fn.multiselect.Constructor.prototype.refresh,$.fn.multiselect.Constructor.prototype.refresh=function(){if(this.options.showSelectedValues){var e={};$(".multiselect-selected-values-option input",this.$dropdownContainer).each(function(){e[$(this).val()]=$(this)}),$("option",this.$select).each($.proxy(function(t,s){var l=$(s),o=e[$(s).val()];o&&(l.is(":selected")?(o.prop("checked",!0),this.options.selectedClass&&o.closest(this.oldDropdownVersion?"li":".multiselect-selected-values-option").addClass(this.options.selectedClass)):(o.prop("checked",!1),this.options.selectedClass&&o.closest(this.oldDropdownVersion?"li":".multiselect-selected-values-option").removeClass(this.options.selectedClass)))},this)),this.refreshOriginal()}},$.fn.multiselect.Constructor.prototype.clearSelectionOriginal=$.fn.multiselect.Constructor.prototype.clearSelection,$.fn.multiselect.Constructor.prototype.clearSelection=function(){this.clearSelectionOriginal(),this.options.showSelectedValues&&this.refresh()},$.fn.multiselect.Constructor.prototype.mergeOptionsOriginal=$.fn.multiselect.Constructor.prototype.mergeOptions,$.fn.multiselect.Constructor.prototype.mergeOptions=function(e){return e.onChangeOriginal=e.onChange,e.onChange=function(e,t){this.options.showSelectedValues&&this.refresh(),this.options.onChangeOriginal&&this.options.onChangeOriginal(e,t)},e.onSelectAllOriginal=e.onSelectAll,e.onSelectAll=function(){this.options.showSelectedValues&&this.refresh(),this.options.onSelectAllOriginal&&this.options.onSelectAllOriginal()},e.onDeselectAllOriginal=e.onDeselectAll,e.onDeselectAll=function(){this.options.showSelectedValues&&this.refresh(),this.options.onDeselectAllOriginal&&this.options.onDeselectAllOriginal()},e.onDropdownShowOriginal=e.onDropdownShow,e.onDropdownShow=function(e){if(this.options.showSelectedValues){this.$dropdownContainer.find(".multiselect-selected-values-entry").remove(),this.$dropdownContainer.find(".multiselect-selected-values-hidden").removeClass("multiselect-selected-values-hidden");var t=this.$select.val();if(t&&t.length){for(var s=t.length-1;s>=0;s--){var l=this.getInputByValue(t[s]).closest(this.oldDropdownVersion?"li":".multiselect-option"),o=l.clone().removeClass("multiselect-option").addClass("multiselect-group-option-indented").addClass("multiselect-selected-values-entry").addClass("multiselect-selected-values-option");o.insertAfter(this.$dropdownContainer.find(".multiselect-selected-values")),this.options.showSelectedValuesCollapsed&&o.addClass("multiselect-collapsible-hidden").hide(),this.options.showSelectedValuesOnlyOnce&&l.addClass("multiselect-selected-values-hidden")}if(!this.options.showSelectedValuesEmpty)(n=this.$dropdownContainer.find(".multiselect-group.multiselect-selected-values")).show(),n.nextAll(this.oldDropdownVersion?".multiselect-item.divider:first":".dropdown-divider:first").show()}else if(this.options.showSelectedValuesEmpty){var i=$('<span class="multiselect-selected-values-entry multiselect-selected-values-none dropdown-item-text">'+this.options.selectedValuesNoValuesText+"</span>");i.insertAfter(this.$dropdownContainer.find(".multiselect-selected-values")),this.options.showSelectedValuesCollapsed&&i.addClass("multiselect-collapsible-hidden").hide()}else{var n;(n=this.$dropdownContainer.find(".multiselect-group.multiselect-selected-values")).hide(),n.nextAll(this.oldDropdownVersion?".multiselect-item.divider:first":".dropdown-divider:first").hide()}this.$dropdownContainer.find(".multiselect-group.multiselect-selected-values").toggleClass("collapsed",this.options.showSelectedValuesCollapsed)}this.options.onDropdownShowOriginal&&this.options.onDropdownShowOriginal(e)},this.mergeOptionsOriginal(e)};
